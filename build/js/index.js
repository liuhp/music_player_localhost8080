var songList,$=window.Zepto,root=window.player,$scope=$(document.body),index=0,audio=new root.audioControl;function bindEvent(){$scope.on("play-change",function(o,e){audio.getAudio(songList[e].audio),"play"==audio.status&&(audio.play(),root.process.start()),root.process.renderAllTime(songList[e].duration)}),$scope.on("click",".prev-btn",function(){control=new root.control(index,songList.length),index=control.prev(),root.render(songList[index]),$scope.trigger("play-change",index),root.process.update(0),$("ul .active").removeClass("active"),$("li").eq(index).addClass("active")}),$scope.on("click",".next-btn",function(){control=new root.control(index,songList.length),index=control.next(),root.render(songList[index]),$scope.trigger("play-change",index),root.process.update(0),$("ul .active").removeClass("active"),$("li").eq(index).addClass("active")}),$scope.on("click",".play-btn",function(){"play"==audio.status?(audio.pause(),root.process.stop()):(audio.play(),root.process.start()),$(this).toggleClass("pause"),$(".img-wrapper").toggleClass("active")}),$scope.on("click",".like-btn",function(){$(".like-btn").toggleClass("liking-btn")}),$scope.on("click",".list-btn",function(){$scope.find(".show-list").css("display","block"),$scope.on("click","li",function(){index=$("li").index($(this)),$("ul .active").removeClass("active"),$(this).addClass("active"),root.render(songList[index]),$scope.trigger("play-change",index),$scope.find(".play-btn").addClass("pause"),audio.play(),$scope.find(".img-wrapper").addClass("active")}),$scope.on("click",".click",function(){$scope.find(".show-list").css("display","none")})}),audio.audio.addEventListener("ended",function(){control=new root.control(index,songList.length),index=control.next(),root.render(songList[index]),$scope.trigger("play-change",index),root.process.update(0),$("ul .active").removeClass("active"),$("li").eq(index).addClass("active")})}function bindTouch(){var o=$scope.find(".slider-pointer"),e=$scope.find(".pro-wrapper").offset(),t=e.left,i=e.width;$scope.trigger("play-change",index),o.on("touchstart",function(){root.process.stop()}).on("touchmove",function(o){var e=(o.changedTouches[0].clientX-t)/i;(e<0||1<e)&&(e=0),root.process.update(e)}).on("touchend",function(o){var e=(o.changedTouches[0].clientX-t)/i;(e<0||1<e)&&(e=0);var n=e*songList[control.index].duration;audio.playTo(n),root.process.start(e),$scope.find(".play-btn").addClass("pause"),$scope.find(".img-wrapper").addClass("active")})}function getData(o){$.ajax({type:"GET",url:o,success:function(o){root.render(o[0]),songList=o,control=new root.control(index,o.length),$scope.trigger("play-change",index),root.list(songList),$("ul .active").removeClass("active"),$("li").eq(index).addClass("active"),bindEvent(),bindTouch()},error:function(){}})}getData("../mock/data.json");